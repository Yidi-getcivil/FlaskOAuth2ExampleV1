<!DOCTYPE html>
<html>
  <head>
    <title>Sign Up</title>
  </head>
  <body>
    <h1>Sign Up</h1>
    <form>
      <label for="email">Email/Username:</label>
      <input type="text" id="email" name="email"><br><br>

      <label for="password">Password:</label>
      <input type="password" id="password" name="password"><br><br>

      <label for="confirm_password">Confirm Password:</label>
      <input type="password" id="confirm_password" name="confirm_password"><br><br>

      <button type="button" id="signup_button">Sign Up</button>
    </form>

    <script>
      const BASE_URL = 'https://api.example.com';
      const ACCESS_TOKEN = 'your_access_token_here';
      let salt;

      function handleSignUpResponse(response) {
        if (response.status === 201) {
          alert('Sign up successful!');
        } else if (response.status === 409) {
          alert('Email already in use.');
        } else {
          alert('Error signing up.');
        }
      }

      function generateSalt() {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        const length = 16;
        let result = '';
        for (let i = 0; i < length; i++) {
          result += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        return result;
      }

      function hashPassword(password) {
        const saltedPassword = password + salt;
        const sha256 = new Hashes.SHA256();
        return sha256.hex(saltedPassword);
      }

      function validatePassword(password) {
        const passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{7,40}$/;
        return passwordRegex.test(password);
      }

      function handleSignUp() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirm_password = document.getElementById('confirm_password').value;

        if (!validatePassword(password)) {
          alert('Invalid password. Password must be 7-40 characters in length and include at least one uppercase letter, at least 1 lowercase letter, at least one number, and at least one special character.');
          return;
        }

        if (password !== confirm_password) {
          alert('Passwords do not match.');
          return;
        }

        salt = generateSalt();
        const hashedPassword = hashPassword(password);

        const url = BASE_URL + '/sign_up';
        const headers = {
          'Content-Type': 'application/x-www-form-urlencoded',
          'Authorization': 'Bearer ' + ACCESS_TOKEN
        };
        const body = new URLSearchParams();
        body.append('email', email);
        body.append('salt', salt);
        body.append('password', hashedPassword);

        fetch(url, {
          method: 'POST',
          headers: headers,
          body: body
        })
        .then(response => handleSignUpResponse(response))
        .catch(error => {
          console.error('Error signing up:', error);
          alert('Error signing up.');
        });
      }

      const signupButton = document.getElementById('signup_button');
      signupButton.addEventListener('click', handleSignUp);
    </script>
  </body>
</html>
